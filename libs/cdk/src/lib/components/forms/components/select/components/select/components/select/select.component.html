<ng-content select="[etInputPrefix]" />

<div class="et-select-wrapper">
  <ng-container *ngIf="select.searchable; then searchInput; else noInput" />

  <ng-template #searchInput>
    <input
      [attr.id]="input.id"
      [attr.aria-labelledby]="input.labelId$ | async"
      [attr.aria-describedby]="input.describedBy$ | async"
      [attr.autocomplete]="input.autocomplete || null"
      [attr.tabindex]="(input.disabled$ | async) ? -1 : 0"
      [attr.aria-required]="(input.required$ | async) || null"
      [attr.aria-disabled]="(input.disabled$ | async) || null"
      [attr.aria-invalid]="(input.invalid$ | async) || null"
      [attr.aria-haspopup]="select.selectType$ | async"
      [attr.aria-controls]="(select.selectBodyId$ | async) || null"
      [attr.aria-expanded]="select.isOpen$ | async"
      [disabled]="input.disabled$ | async"
      [attr.aria-activedescendant]="select.activeDescendant$ | async"
      (click)="open()"
      (keydown)="select.handleKeyDown($event)"
      class="et-select-input et-select-input--searchable"
      type="text"
      role="combobox"
      aria-autocomplete="list"
      etNativeInputRef
    />
  </ng-template>

  <ng-template #noInput>
    <div
      [attr.id]="input.id"
      [attr.aria-labelledby]="input.labelId$ | async"
      [attr.aria-describedby]="input.describedBy$ | async"
      [attr.tabindex]="(input.disabled$ | async) ? -1 : 0"
      [attr.aria-required]="(input.required$ | async) || null"
      [attr.aria-disabled]="(input.disabled$ | async) || null"
      [attr.aria-invalid]="(input.invalid$ | async) || null"
      [attr.aria-haspopup]="select.selectType$ | async"
      [attr.aria-controls]="(select.selectBodyId$ | async) || null"
      [attr.aria-expanded]="select.isOpen$ | async"
      [attr.aria-activedescendant]="select.activeDescendant$ | async"
      (click)="open()"
      (keydown)="select.handleKeyDown($event)"
      class="et-select-input et-select-input--static"
      role="combobox"
      aria-autocomplete="list"
    ></div>
  </ng-template>

  <span>
    <ng-container *ngIf="select.selectedOption$ | async as selectedOption; else emptyTpl">
      <ng-container *ngIf="selectedOption.optionTemplate$ | async as tpl">
        <ng-container *ngTemplateOutlet="tpl" />
      </ng-container>
    </ng-container>
    <ng-template #emptyTpl> Please select </ng-template>
  </span>

  <et-chevron-icon class="et-select-chevron" />
</div>

<ng-content select="[etInputSuffix]" />

<ng-template #selectBodyTpl>
  <ng-content />
</ng-template>
