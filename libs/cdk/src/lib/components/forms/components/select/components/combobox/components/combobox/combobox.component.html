<!-- eslint-disable @angular-eslint/template/click-events-have-key-events -->
<ng-content select="[etInputPrefix]" />

<div class="et-combobox-wrapper">
  <ul *ngIf="combobox.multiple$ | async" class="et-combobox-selected-options">
    <li
      *ngFor="let item of combobox.selectedOptions$ | async; trackBy: combobox.trackByOptionKeyFn"
      class="et-combobox-selected-option"
    >
      <ng-container
        *ngIf="
          combobox.customSelectedOptionTpl$ | async as customSelectedOptionTpl;
          else compOrDefaultSelectedOptionLabelTpl
        "
      >
        <ng-container *ngTemplateOutlet="customSelectedOptionTpl; context: { option: item }" />
      </ng-container>

      <ng-template #compOrDefaultSelectedOptionLabelTpl>
        <ng-container
          *ngIf="combobox.customSelectedOptionComponent$ | async as comp; else defaultSelectedOptionLabelTpl"
        >
          <ng-container *ngComponentOutlet="comp; inputs: { option: item }"></ng-container>
        </ng-container>
        <ng-template #defaultSelectedOptionLabelTpl>
          {{ combobox.getOptionLabel(item) | async }}
        </ng-template>
      </ng-template>

      <span
        (click)="combobox.removeSelectedOption(item); $event.stopPropagation()"
        class="et-combobox-selected-option-remove"
        tabindex="-1"
      >
        x
      </span>
    </li>
    <li class="et-combobox-muliple-input">
      <ng-container *ngTemplateOutlet="inputTpl" />
    </li>
  </ul>

  <span
    *ngIf="(combobox.multiple$ | async) && input.placeholder"
    class="et-combobox-muliple-placeholder"
    aria-hidden="true"
  >
    {{ input.placeholder }}
  </span>

  <ng-template #inputTpl>
    <input
      [disabled]="input.disabled"
      [attr.placeholder]="(combobox.multiple$ | async) ? null : input.placeholder"
      (keydown)="combobox._processKeydownEvent($event)"
      (keyup)="combobox._processKeyupEvent()"
      (click)="combobox.open()"
      (blur)="combobox._handleBlurEvent()"
      (input)="combobox._processInputEvent($event)"
      type="text"
      value="{{ combobox.currentFilter }}"
      etNativeInputRef
    />
  </ng-template>

  <ng-container *ngIf="(combobox.multiple$ | async) === false">
    <ng-container *ngTemplateOutlet="inputTpl" />
  </ng-container>

  <et-chevron-icon class="et-combobox-chevron" />
</div>

<ng-content select="[etInputSuffix]" />

<ng-template>
  <ng-content />
</ng-template>
