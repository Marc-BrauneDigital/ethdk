<!-- eslint-disable @angular-eslint/template/click-events-have-key-events -->
<!-- eslint-disable @angular-eslint/template/use-track-by-function -->
<ng-content select="[etInputPrefix]" />

<div class="et-combobox-wrapper">
  <ul *ngIf="combobox.multiple$ | async" class="et-combobox-selected-options">
    <li *ngFor="let item of combobox.selectedOptions$ | async" class="et-combobox-selected-option">
      <ng-container
        *ngIf="combobox.customSelectedOptionTpl$ | async as customSelectedOptionTpl; else defaultSelectedOptionLabelTpl"
      >
        <ng-container *ngTemplateOutlet="customSelectedOptionTpl; context: { option: item }" />
      </ng-container>

      <ng-template #defaultSelectedOptionLabelTpl>
        {{ combobox.getOptionLabel(item) | async }}
      </ng-template>

      <span
        (click)="combobox.removeSelectedOption(item); $event.stopPropagation()"
        class="et-combobox-selected-option-remove"
        tabindex="-1"
      >
        x
      </span>
    </li>
    <li class="et-combobox-muliple-input">
      <ng-container *ngTemplateOutlet="inputTpl" />
    </li>
  </ul>

  <ng-template #inputTpl>
    <input
      (keydown)="combobox._processKeydownEvent($event)"
      (click)="combobox.open()"
      (blur)="combobox._handleBlurEvent()"
      (input)="combobox._processInputEvent($event)"
      type="text"
      etNativeInputRef
    />
  </ng-template>

  <ng-container *ngIf="(combobox.multiple$ | async) === false">
    <ng-container *ngTemplateOutlet="inputTpl" />
  </ng-container>

  <et-chevron-icon class="et-combobox-chevron" />
</div>

<ng-content select="[etInputSuffix]" />

<ng-template>
  <ng-content />
</ng-template>
